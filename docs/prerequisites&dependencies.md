# Python

## Prerequisites
The following prerequisites are assumed.  For Windows, the use of [chocolatey](https://chocolatey.org/) is
recommended.  For Mac, the use of [homebrew](https://brew.sh/) is recommended.

1.  Node.js 6.x or later must be installed on your local machine.
1. `python` must be installed on the local machine.
    1. The version 3.8 is recommended.
    1. Used for running `pre-commit`
1. `pip` must be installed on the local machine.
    1. This is used for installing `pre-commit`
    1. Needed on the local machine, as `pre-commit` is triggered via a `git commit`.
1. `git` must be installed on the local machine.
1. `docker` must be installed on the local machine.
1. `docker-compose` must be installed on the local machine.
1. `make` must be installed on the local machine.
1. `PIP_EXTRA_INDEX_URL` environment variable must be set on the local machine.
    1. Set to `https://agero-python:YOUR_PAT@pkgs.dev.azure.com/agero-ops/_packaging/agero-python/pypi/simple`
    1. Replace `YOUR_PAT` with a personal access token, generated by following [these instructions](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page).
    1. The scope needed is `Packaging (read)`.

## Powershell Script installation

Either install following steps individually or run [get-started-installations.ps1](/cli-windows/get-started-installations.ps1) powershell script in administrative mode.

Still verify all the following steps.

## Dependencies

### Application Dependencies

[fastapi](https://fastapi.tiangolo.com/)

Python-based API framework used for ASGI (Asynchronous Server Gateway Interface) applications.  Is used as the main
application entry point.
* [src/api/api.py](/src/api/api.py)

----
[mangum](https://erm.github.io/mangum/)

Used as an adapter between API Gateway Lambda Event and ASGI application.
* [src/handler.py](/src/handler.py)

----
[pydantic](https://pydantic-docs.helpmanual.io/)

Used for generating automatically validated Python models.  This is used for both FastAPI input and output, as well
as Agero internal libraries.
* [src/models/commands/create_agentassignment.py](/src/models/commands/create_agentassignment.py)
* [src/models/domain/agentassignment.py](/src/models/domain/agentassignment.py)

----
[pynamodb](https://pynamodb.readthedocs.io/en/latest/)

ORM used to simplify DynamoDB interactions.
* [src/services/dynamodb_tables.py](/src/services/dynamodb_tables.py)

----
[boto3](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html)

AWS SDK.  Used to perform secrets decryption.
* [src/utilities/decrypt.py](/src/utilities/decrypt.py)

----
[agero-python-logger](https://bitbucket.org/agero/agero-python-logger/src/master/)

Agero created module to provide consistent logging across Python applications in a Splunk-friendly JSON format.
* [src/utilities/logging.py](/src/utilities/logging.py)

----
[agero-python-configuration](https://bitbucket.org/agero/agero-python-configuration/src/master/)

Agero created module to provide multi-layer application configuration, using config files and environment variables.
* [src/config/configuration_manager.py](/src/config/configuration_manager.py)
* [config/config.yml](/config/config.yml)
* [config/config.QualityAssurance.yml](/config/config.QualityAssurance.yml)
* [config/config.Staging.yml](/config/config.Staging.yml)
* [config/config.Production.yml](/config/config.Production.yml)
* [serverless/config/qa/envvars.yml](/serverless/config/qa/envvars.yml)
* [serverless/config/stage/envvars.yml](/serverless/config/stage/envvars.yml)
* [serverless/config/prod/envvars.yml](/serverless/config/prod/envvars.yml)

----
[requests](https://requests.readthedocs.io/en/master/)

Python and fast HTTP clients. Requests is an elegant and simple HTTP library for Python

----
[zeep](https://docs.python-zeep.org/en/master/)

A fast and modern Python SOAP client. Zeep inspects the WSDL document and generates the corresponding code to use the services and types in the document. This provides an easy to use programmatic interface to a SOAP server.

----

### Development Dependencies

[pytest](https://docs.pytest.org/en/latest/)

Recommended test runner that provides functionality above and beyond built-in unittest module, such as fixtures and a
robust ecosystem of plugins.  Runs all functions prefixed with `test_` in `tests` directory.

----
[pytest-asyncio](https://github.com/pytest-dev/pytest-asyncio)

PyTest plugin used to greatly simplify testing asynchronous code.
* [tests/utilities/test_exception_handlers.py](/tests/utilities/test_exception_handlers.py)

----
[pytest-cov](https://pypi.org/project/pytest-cov/)

PyTest plugin to produce coverage reports.
* [.coveragerc](/.coveragerc)

----
[moto](http://docs.getmoto.org/en/latest/)

Module used for extensive mocking of AWS Services.  Provides a level of integration testing without relying on real
AWS services.  Overkill for most unit tests.
* [tests/services/test_case_service.py](/tests/services/test_case_service.py)

----
[pre-commit](https://pre-commit.com/)

Module used for linting prior to committing code into repo.  Included here so that linting can be performed within
build pipeline.
* [.pre-commit-config.yaml](/.pre-commit-config.yaml)

----
[uvicorn](https://www.uvicorn.org/)

Module used to provide a web server to host ASGI applications locally.

* [Pipfile](/Pipfile)


## Testing

Testing is performed via the PyTest runner.  The provides a robust testing framework that supports fixtures, data
driven tests, and more.  PyTest will assume that any function in your test directory with the prefix `test_` is a test
to run.

### [unittest.mock](https://docs.python.org/3.8/library/unittest.mock.html)

This module provides a lot of built in tools to make testing your code very simple.  Commonly used components of this
module include:

* __MagicMock__: This class creates a callable mock that has any property or method available "Magically".  These will
themselves return a `MagicMock`.
    * [tests/conftest.py](/tests/conftest.py)
* __create_autospec__: This function will take as a parameter any Python object and return a `MagicMock` that adheres
to the interface of the object.  If accessing a parameter or a method on the `MagicMock` that doesn't exist on the base
object, an exception will be raised.  This makes this much safer than using `MagicMock` by itself.
    * [tests/conftest.py](/tests/conftest.py)
* __patch__: This function takes a string as a parameter than represents the path to an object.  It will create a
context that will override the behavior of said object by returning a `MagicMock`.  Optional keyword argument of
`autospec=True` is highly recommended to gain the same benefits as `create_autospec`.
    * [tests/utilities/test_service_manager.py](/tests/utilities/test_service_manager.py)


