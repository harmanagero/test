# Settings your development environment to run serverless Projects

##	Prerequisites

Please check all the prerequisites and dependencies at following locations:

[prerequisites&dependencies](/docs/prerequisites&dependencies.md)

## Installations

Either install following steps individually or run [get-started-installations.ps1](/cli-windows/get-started-installations.ps1) powershell script in administrative mode.

### Install Visual Studio Code

Download Visual Studio Code from the following location.

[Visual Studio Code](https://code.visualstudio.com/download)

### Install chocolately

chocolately is windows package manager. It makes it very easy to setup the software and automate the installation of it.
Go to chocolately.org/install and then run the powershell script. Have the powershell open in administration tab.

Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))

[chocolatey](https://chocolatey.org/install)

### Install Python 3.8

Check the python version on your machine and if its not installed then install Python from following link and after you are done installation, it will ask you to set the path for Python and scripts. Please check that box.
Install: https://www.python.org/downloads/release/python-385/

Ensure that your path is set correctly. Go the environment variables on your system and check following and if path doesn’t exist then use following commands to set it up.

Run the following command:

    $ py -m site --user-site

A sample output can be:

C:\Users\jetbrains\AppData\Roaming\Python\Python38\site-packages
Replace site-packages with Scripts in this path to receive a string for adding to the PATH variable, for example:

    $ setx PATH "%PATH%;C:\Users\jetbrains\AppData\Roaming\Python\Python38\Scripts"


###	Environment Variables

Add PIP_EXTRA_INDEX_URL to the environment variable and restart your machine.

1. `PIP_EXTRA_INDEX_URL` environment variable must be set on the local machine.
    1. Set to `https://agero-python:YOUR_PAT@pkgs.dev.azure.com/agero-ops/_packaging/agero-python/pypi/simple`
    1. Replace `YOUR_PAT` with a personal access token, generated by following [these instructions](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page).
    1. The scope needed is `Packaging (read)`.

### Install Pip, Pipenv & Virtual Environments

Run the following command to ensure you have pip installed in your system:

Check version:
    $ pip --version
    $ pipenv --version

Installing pipenv
After the preparation steps are done, you can use pipenv to create a virtual environment for new or existing projects. Check if pipenv exists.

Commands:
    $ pipenv
    $ pipenv Install
You can also install pipenv by running the following command:

    $ pip install --user pipenv
If somehow above command don’t work then use following commands:
    $ Pip uninstall pipenv
    $ Pip install pipenv

Sync your virtual environment:
Following command installs all packages specified in Pipfile.lock and setup virtual environment.

    $ pipenv sync --dev
	$ pipenv --venv

Above command should give you virtual environment path. If this path isn’t returning then your setup isn’t right.
Url to install Pipenv: [pipenv](https://www.jetbrains.com/help/pycharm/pipenv.html)

###	Install Black

$pipenv install black --pre --skip-lock --dev
$pipenv lock



###	Install docker-desktop

Installs docker host, command line and user interface to interact with it.

    Command: Choco install docker-desktop

Sign into docker desktop local app. Send email to Arch team to add you to Agero Docker hub Organization. Open Docker-desktop on your machine and go to settings -> Resources -> File Sharing -> Add C:\ -> Restart the machine.

### Install make

Ensure make is installed.
For Windows use chocolatey to choco install mingw
Anywhere make is referenced, use mingw32-make (or rename mingw32-make.exe to make.exe)

Open  powershell in administration mode and run following command.

    Command: choco install mingw

Once installed, go to C:\ProgramData\chocolatey\bin and rename mingw to make.


###	Install Extensions

Go to visual studio code and open your project and then go to extensions and add extension:
    o	Remote-containers.
    o	Pylance
    o	Python

###	Install Git bash

Download link: https://gitforwindows.org/
It installs Git Bash, Git GUI, and shell integration.

### Install Remote Containers

[remotecontainers](/docs/remotecontainers.md)


## Debugging the solution

### Debugging in VS Code

•	Open the repository in VsCode and click to run.

•	VsCode will ask for you to select Launch file. Select node.js. It will add launch.json file.

•	Select add configuration and either build your own configuration or add following section in configuration[] to run Flask based project and update your own AWS credentials and get API key from specific configuration file:

    To run project using Fast API:
        {
            "name": "Python: Fast API",
            "type": "python",
            "request": "launch",
            "module": "uvicorn",
            "env": {
                "LOG_LEVEL": "DEBUG",
                "AWS_ACCESS_KEY_ID": "**",
                "AWS_SESSION_TOKEN": "****",
                "AWS_DEFAULT_REGION": "us-east-1"

            },
            "args": [
                "src.api.api:app",
                "--reload",
                "--port",
                "5000",
                "--host",
                "0.0.0.0"
            ],
        }

    To run project using Py Tests:

        {
            "name": "PyTest",
            "type": "python",
            "request": "launch",
            "module": "pytest",
            "env": {
                "LOG_LEVEL": "DEBUG",
                "AWS_ACCESS_KEY_ID": "**",
                "AWS_SECRET_ACCESS_KEY": "**",
                "AWS_SESSION_TOKEN": "**",
                "AWS_DEFAULT_REGION": "us-east-1"
            },
            "args":[
                "-v",
                "--no-cov",
                "tests/"
            ]
        }

### Debugging on local outside docker container

Select right python Intepreter from your .virtualenvs\{project location}\

e.g.- C:\Users\hkaur\.virtualenvs\ConnectedVehicle-NGP2-wop67nBr\Scripts\python.exe

### Debugging on local inside docker container

Select right python Intepreter

/root/.local/share/virtualenvs/workspace-dqq3IVyd/bin/python

### Debugging in PyCharm

Some IDEs, such as PyCharm Professional Edition, support debugging code through the IDE, even when invoked on a remote
interpreter.  Regardless of the support, the following can be used to debug code from the commandline:

* Set a breakpoint in the code via `import pdb; pdb.set_trace()`
* To debug a test, set breakpoints and run `make test`
* To debug the application, set breakpoints and run `make debug`
    * Note that `make run` will also trigger any breakpoints, but you will not have the ability to input commands.
    * Making any modification to the code after `make debug` will trigger the `uvicorn` module to reload the application
* Once a breakpoint is hit, the command line will turn into an input prompt.
    * Type `p variable_name` followed by Enter to print the variable to the screen
    * Type `c` followed by Enter to continue.
    * Type `s` followed by Enter to step into.
    * Full documentation is [available here](https://docs.python.org/3.8/library/pdb.html#debugger-commands).



### Refresh

Occassionally refresh the images.

docker pull agero/lambda:build-python3.8
